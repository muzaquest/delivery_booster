# Аналитика продаж ресторанов (FastAPI + PostgreSQL + ETL + ML)

Модульная система аналитики и прогноза продаж с FastAPI, PostgreSQL, ETL, и ML (LightGBM/RandomForest + SHAP).

## Быстрый старт (локально)

Требования: Python 3.11+

1) Виртуальное окружение

```bash
python3 -m venv .venv
source .venv/bin/activate
```

2) Установка зависимостей

```bash
pip install -r requirements.txt
```

3) Запуск API

```bash
uvicorn app.main:app --reload
```

4) Streamlit UI (3 вкладки)

```bash
streamlit run streamlit_app.py --server.port=8501 --server.address=0.0.0.0
```

Вкладки:
- Анализ ресторана: выбор ресторана и периода, генерация полного отчёта (1–9), сохранение в `reports/` и скачивание `.md`.
- Анализ базы: KPI‑панель (Sales, Orders, AOV, ROAS, MER, Cancels) и MoM сравнение.
- Свободный запрос (AI): ответы на основе БД+ML (для расширенных ответов задайте `OPENAI_API_KEY`).

5) Проверка здоровья

```bash
curl http://127.0.0.1:8000/health
# {"status": "ok"}
```

## PostgreSQL

Переменные окружения (или `DATABASE_URL`):

- `POSTGRES_HOST` (по умолчанию: localhost)
- `POSTGRES_PORT` (по умолчанию: 5432)
- `POSTGRES_DB` (по умолчанию: analytics)
- `POSTGRES_USER` (по умолчанию: postgres)
- `POSTGRES_PASSWORD` (по умолчанию: postgres)

Создание таблиц:

```bash
python db/init_db.py
```

## ETL

- SQLite-источник: `/workspace/database.sqlite`
- Турпоток (Excel): `/workspace/1.-Data-Kunjungan-2025-3.xls`, `/workspace/Table-1-7-Final-1-1.xls`
- Fake orders: файл `/workspace/Fake orders` содержит Google Sheet ссылку; либо передайте `--fake-orders-sheet`.

Сборка объединённого датасета:

```bash
python etl/data_loader.py --run \
  --start 2023-01-01 --end 2025-12-31 \
  --out /workspace/data/merged_dataset.csv \
  --excel /workspace/1.-Data-Kunjungan-2025-3.xls /workspace/Table-1-7-Final-1-1.xls
```

## Обучение ML-модели и объяснимость (SHAP)

```bash
python ml/training.py --csv /workspace/data/merged_dataset.csv --out /workspace/ml/artifacts
```

- Модели: LightGBM и RandomForest (выбираем чемпиона по MAE)
- Артефакты: `ml/artifacts/model.joblib`, `features.json`, `shap_background.csv`, `metrics.json`
- Версия датасета: `metrics.json` содержит хэш, размер и время обучения; в отчёте печатается краткая версия.

## API (после ETL и обучения)

- `GET /report?period=YYYY-MM-DD_YYYY-MM-DD&restaurant_id=...` — сводка: факт/прогноз, AOV, ТОП‑факторы (SHAP)
- `GET /factors?period=...&restaurant_id=...` — список факторов с влиянием в % (SHAP)
- `GET /report-text?period=...&restaurant_id=...` — полный текстовый отчёт на русском (со всеми разделами и ML)

## Тесты

```bash
pytest -q
```
- Smoke‑тест API: `/health`
- Снапшот‑тест отчёта: проверяет наличие разделов 1–9 для одного ресторана/периода

## Развёртывание на Replit

1) Импортируйте репозиторий в Replit.
2) В Secrets (Environment) задайте при необходимости:
   - `GOOGLE_API_KEY` — для Google Sheets с фейковыми заказами
   - `SQLITE_PATH` — путь к SQLite (по умолчанию `/workspace/database.sqlite`)
   - `DATABASE_URL`/`POSTGRES_*` — если используете внешнюю PostgreSQL
3) Первый запуск: выполните ETL и обучение, затем старт сервера и UI:

```bash
python etl/data_loader.py --run --start 2023-01-01 --end 2025-12-31 --out /workspace/data/merged_dataset.csv
python ml/training.py --csv /workspace/data/merged_dataset.csv --out /workspace/ml/artifacts
uvicorn app.main:app --host 0.0.0.0 --port 8000 &
streamlit run streamlit_app.py --server.port=8501 --server.address=0.0.0.0
```

## Примечания честности данных
- Фейковые заказы вычитаются из заказов и выручки
- Погода — Open‑Meteo по координатам ресторанов (кеш в SQLite; фолбэк по геокодингу)
- Праздники — Nager.Date + локальные балийские (скрейпинг 2024/2025; при недоступности источника — кеш)
- Туристический поток — из предоставленных Excel
- Модель обучается на всём периоде (2.5 года), факторы — SHAP; тривиальные признаки исключены из объяснений

## Пример полного отчёта (Ika Canggu, Q2 2025)

Ниже приведён реальный вывод `/report-text?period=2025-04-01_2025-06-30&restaurant_id=11`:

```
Версия датасета:  · строк: 13433 · тренировался: 2025-01-15 · модель: random_forest

📊 1. ИСПОЛНИТЕЛЬНОЕ РЕЗЮМЕ
════════════════════════════════════════════════════════════════════════
💰 Общая выручка: 1 080 876 000 IDR (GRAB: 566 578 400 IDR + GOJEK: 514 297 600 IDR)
📦 Общие заказы: 2648
   ├── 📱 GRAB: 1204 (успешно: 1202, отмены: 2, потери: 0, fake: 0)
   └── 🛵 GOJEK: 1444 (успешно: 1214, отмены: 0, потери: 135, fake: 95)
💵 Средний чек (успешные): общий 447 382 IDR; GRAB 471 363 IDR; GOJEK 423 639 IDR
📊 Дневная выручка: 12 913 649 IDR (средняя по рабочим дням)
⭐ Средний рейтинг: 4.79/5.0
👥 Обслужено клиентов: 1568
   ├── 📱 GRAB: 1161 (новые: 662, повторные: 465, реактивированные: 34)
   └── 🛵 GOJEK: 407 (новые: 104, активные: 246, возвратившиеся: 57)
   💡 Общий охват: 1568 уникальных клиентов
💸 Маркетинговый бюджет: 27 391 282 IDR (2.5% от выручки)
📊 Детализация маркетинговых затрат:
   ┌─ 📱 GRAB:
   │  💰 Бюджет: 18 004 742 IDR
   └─ 🛵 GOJEK:
      💰 Бюджет: 9 386 540 IDR

🎯 ROAS АНАЛИЗ:
├── 📱 GRAB: 25.07x
├── 🛵 GOJEK: 39.59x
└── 🎯 ОБЩИЙ: 30.05x

📈 2. АНАЛИЗ ПРОДАЖ И ТРЕНДОВ
————————————————————————————————————————————————————————————————————————
📊 Динамика по месяцам:
  2025-04: 412 485 700 IDR (30 дней, 13 749 523 IDR/день)
  2025-05: 436 046 600 IDR (31 дней, 14 066 019 IDR/день)
  2025-06: 232 343 700 IDR (30 дней, 7 744 790 IDR/день)

🗓️ Выходные vs Будни:
  📅 Средние продажи в выходные: 13 290 446 IDR
  📅 Средние продажи в будни: 12 913 649 IDR
  📊 Эффект выходных: 2.9%
📊 АНАЛИЗ РАБОЧИХ ДНЕЙ:
🏆 Лучший день: 2025-05-18 - 23 592 200 IDR
   💰 GRAB: 10 000 600 IDR (19 заказов) | GOJEK: 13 591 600 IDR (33 заказов)
📉 Худший день: 2025-06-22 - 0 IDR
   💰 GRAB: — | GOJEK: 0 IDR

👥 3. ДЕТАЛЬНЫЙ АНАЛИЗ КЛИЕНТСКОЙ БАЗЫ
————————————————————————————————————————————————————————————————————————
📊 Структура клиентской базы (GRAB + GOJEK):
  🆕 Новые клиенты: 766
    📱 GRAB: 662 | 🛵 GOJEK: 104
  🔄 Повторные клиенты: 711
    📱 GRAB: 465 | 🛵 GOJEK: 246
  📲 Реактивированные: 91
    📱 GRAB: 34 | 🛵 GOJEK: 57

💰 Доходность по типам клиентов (только GRAB, только с рекламы):
  🆕 Новые: 293 184 400 IDR
  🔄 Повторные: 165 662 300 IDR
  📲 Реактивированные: 13 869 100 IDR

📈 4. МАРКЕТИНГОВАЯ ЭФФЕКТИВНОСТЬ И ВОРОНКА
————————————————————————————————————————————————————————————————————————
📊 Маркетинговая воронка (только GRAB):
  👁️ Показы рекламы: 143408
  🔗 Посещения меню: 6729 (CTR: 4.7%)
  🛒 Добавления в корзину: 1425 (конверсия: 12.1% от кликов)
  📦 Заказы от рекламы: 815 (конверсия: 57.2% от корзины)

  📊 КЛЮЧЕВЫЕ КОНВЕРСИИ:
  • 🎯 Показ → Заказ: 0.6%
  • 🔗 Клик → Заказ: 12.1%
  • 🛒 Корзина → Заказ: 57.2%

  📉 ДЕТАЛЬНЫЙ АНАЛИЗ ВОРОНКИ:
  • 💔 Доля ушедших без покупки: 78.8% (5304 ушли без покупки)
  • 🛒 Доля неоформленных корзин: 42.8% (610 добавили, но не купили)

  💰 ПОТЕНЦИАЛ ОПТИМИЗАЦИИ ВОРОНКИ:
  • 📈 Снижение доли ушедших на 10%: 168 021 303 IDR
  • 🛒 Устранение неоформленных корзин: 337 868 671 IDR
  • 🎯 Общий потенциал: 505 889 974 IDR

💸 Стоимость привлечения (GRAB):
  💰 CPC: 2 676 IDR (расчёт: бюджет ÷ посещения меню)
  💰 CPA: 22 092 IDR (расчёт: бюджет ÷ заказы от рекламы)

5. 💳 ФИНАНСОВЫЕ ПОКАЗАТЕЛИ
————————————————————————————————————————————————————————————————————————
💰 Выплаты:
   ├── 📱 GRAB: 433 012 906 IDR (52.2%)
   ├── 🛵 GOJEK: 396 240 391 IDR (47.8%)
   └── 💎 Общие выплаты: 829 253 297 IDR
📊 Рекламная эффективность:
   ├── 💰 Общие рекламные продажи: 823 063 600 IDR
   ├── 📈 Доля от общих продаж: 76.1%
   ├── 🎯 GRAB ROAS: 25.07x
   └── 🎯 GOJEK ROAS: 39.59x

Дополнительно:
   • Take rate (доля комиссий и удержаний): GRAB 20.4%, GOJEK 21.1%
   • Чистый ROAS: GRAB 19.96x; GOJEK 31.23x
   • Юнит‑экономика рекламного заказа (GRAB): 418 820 IDR

6. ⏰ ОПЕРАЦИОННЫЕ МЕТРИКИ
————————————————————————————————————————————————————————————————————————
🟢 GRAB:
└── ⏰ Время ожидания водителей: 10.1 мин

🟠 GOJEK:
├── ⏱️ Время приготовления: 19.2 мин
├── 🚗 Время доставки: 10.8 мин  
└── ⏰ Время ожидания водителей: 11.7 мин

⚠️ ОПЕРАЦИОННАЯ ЭФФЕКТИВНОСТЬ
————————————————————————————————————————————————————————————————————————
🚫 Отмененные заказы:
   ├── 📱 GRAB: 2 заказа
   └── 🛵 GOJEK: 0 заказа
   💡 Всего отмененных: 2 заказов (0.1%)

🔧 ОПЕРАЦИОННЫЕ СБОИ ПЛАТФОРМ:
├── 📱 GRAB: 3 критичных дня (11:48:00 общее время)
├── 🛵 GOJEK: 1 критичных дня (1:30:00 общее время)
└── 💸 Потенциальные потери: 3 414 410 IDR (0.3%)

🚨 КРИТИЧЕСКИЕ СБОИ (>1 часа):
   • 2025-05-05: GRAB offline 1:26:60 (потери: ~376 162 IDR)
   • 2025-05-05: GOJEK offline 1:30:00 (потери: ~353 226 IDR)
   • 2025-05-11: GRAB offline 8:00:00 (потери: ~2 075 379 IDR)
   • 2025-05-15: GRAB offline 2:21:00 (потери: ~609 643 IDR)

7. ⭐ КАЧЕСТВО ОБСЛУЖИВАНИЯ И УДОВЛЕТВОРЕННОСТЬ (GOJEK)
————————————————————————————————————————————————————————————————————————
📊 Распределение оценок (всего: 148):
  ⭐⭐⭐⭐⭐ 5 звезд: 134 (90.5%)
  ⭐⭐⭐⭐ 4 звезды: 1 (0.7%)
  ⭐⭐⭐ 3 звезды: 4 (2.7%)
  ⭐⭐ 2 звезды: 0 (0.0%)
  ⭐ 1 звезда: 9 (6.1%)

📈 Индекс удовлетворенности: 4.70/5.0
🚨 Негативные отзывы (1-2★): 9 (6.1%)

📊 Частота плохих оценок (не 5★):
  📈 Плохих оценок всего: 14 из 148 (9.5%)
  📦 Успешных заказов GOJEK на 1 плохую оценку: 86.70

8. 🚨 КРИТИЧЕСКИЕ ДНИ
════════════════════════════════════════════════════════════════════════
📊 Найдено критических дней (падение ≥30%): 5 из 61 (8.2%)
📈 Медианные продажи: 13.8M IDR
📉 Порог критичности: 9.7M IDR
💸 Общие потери от критических дней: 25.4M IDR

🔴 2025-04-01

### 📊 **КЛЮЧЕВЫЕ ЦИФРЫ**
- **Продажи:** 8.4M IDR (медиана: 13.8M IDR) → **-39.5%**
- **Потери:** 5.5M IDR
- **Заказы:** 26 шт (норма: 34) → **-24%**
- **Средний чек:** 321K IDR (норма: 406K IDR) → **-21%**

### 🔍 **РЕАЛЬНЫЕ ПРИЧИНЫ**

**1. 🔴 КРИТИЧЕСКОЕ УРЕЗАНИЕ РЕКЛАМНОГО БЮДЖЕТА**
- Общий бюджет 222K IDR против нормы 342K IDR (-35%)
- **Влияние:** ~1.8M IDR потенциальных потерь

**2. 🔴 КРИТИЧЕСКОЕ ПАДЕНИЕ СРЕДНЕГО ЧЕКА**
- Средний чек 321K IDR против нормы 406K IDR (-21%)
- **Влияние:** 2.2M IDR прямых потерь

### 🌍 **ВНЕШНИЕ ФАКТОРЫ**

**🕌 Праздники:** Eid al-Fitr (окончание Рамадана) — крупнейший мусульманский праздник, курьеры отдыхают, семейные застолья дома
**🌧️ Погода:** без дождя, комфортная температура 28.5°C

### ✅ **ЧТО ПОМОГЛО ИЗБЕЖАТЬ БОЛЬШИХ ПОТЕРЬ**

**💪 Высокая эффективность рекламы GRAB:**
- ROAS 25.3x (отличный результат)

**💪 Высокое качество сервиса:**
- Средний рейтинг 4.8/5.0

### 🎯 **КОНКРЕТНЫЕ РЕКОМЕНДАЦИИ**

**1. 🔴 Увеличить рекламный бюджет на 50-100% в праздники**
- **Потенциальный эффект:** 3.3M IDR

**2. 🔴 Таргетинг на немусульман и туристов в религиозные праздники**
- **Потенциальный эффект:** 1.6M IDR

**3. 🟡 Запустить upsell стратегию: промо при заказе >400K IDR**
- **Потенциальный эффект:** 2.2M IDR

### 💰 **ФИНАНСОВЫЙ ИТОГ**
- **Общий потенциал восстановления:** 7.1M IDR (129% от потерь)

🔴 2025-04-15

### 📊 **КЛЮЧЕВЫЕ ЦИФРЫ**
- **Продажи:** 7.9M IDR (медиана: 13.8M IDR) → **-42.5%**
- **Потери:** 5.9M IDR
- **Заказы:** 23 шт (норма: 34) → **-32%**

### 🔍 **РЕАЛЬНЫЕ ПРИЧИНЫ**

**1. 🔴 НИЗКАЯ РЕКЛАМНАЯ АКТИВНОСТЬ**
- GRAB: бюджет 129K IDR против нормы 220K IDR (-41%)
- GOJEK: бюджет 73K IDR против нормы 132K IDR (-45%)
- **Влияние:** ~4.2M IDR потерь

**2. 🟡 СНИЖЕНИЕ КОНВЕРСИИ**
- GRAB: 12 заказов против нормы 15 (-20%)
- GOJEK: 11 заказов против нормы 19 (-42%)

### 🌍 **ВНЕШНИЕ ФАКТОРЫ**
**🕌 Праздники:** обычный понедельник, не праздник
**🌧️ Погода:** без дождя, комфортная температура

### 🎯 **РЕКОМЕНДАЦИИ**

**1. 🔴 Восстановить рекламный бюджет до 350K+ IDR/день**
- **Потенциальный эффект:** 4.2M IDR

**2. 🟡 Оптимизировать таргетинг для увеличения конверсии**
- **Потенциальный эффект:** 1.8M IDR

### 💰 **ФИНАНСОВЫЙ ИТОГ**
- **Потенциал восстановления:** 6.0M IDR (102% от потерь)

🔴 2025-04-15: 7.9M IDR (-42.5%) — потери 5.9M IDR
🔴 2025-04-18: 8.8M IDR (-36.5%) — потери 5.0M IDR  
🔴 2025-04-14: 9.0M IDR (-34.9%) — потери 4.8M IDR
🔴 2025-05-23: 9.6M IDR (-30.6%) — потери 4.2M IDR

(каждый день получает полный детальный анализ)

💸 **ОБЩИЕ ПОТЕРИ ОТ ВСЕХ КРИТИЧЕСКИХ ДНЕЙ: 25.4M IDR**

📊 ОБЩИЕ ВЫВОДЫ
────────────────────────────────────────
📊 Всего критических дней: 5 из 61 (8.2%)
🕌 Праздничных дней: 1 (20%) — Eid al-Fitr
🌧️ Дождливых дней: ~2 (40%)
📈 Средние потери на критический день: 5.1M IDR

🎯 ПРИОРИТЕТНАЯ РЕКОМЕНДАЦИЯ:
   Разработать стратегию работы в праздничные и дождливые дни

📋 ИСТОЧНИКИ ДАННЫХ:
- SQLite (grab_stats, gojek_stats) — операционные данные
- Open-Meteo API — погодные данные  
- Holidays cache — праздники (мусульманские, балийские, индонезийские, международные)
- ML модель (Random Forest) — SHAP анализ факторов

9. 🎯 EXECUTIVE SUMMARY & СТРАТЕГИЧЕСКИЙ ПЛАН
════════════════════════════════════════════════════════════════════════

📊 СОСТОЯНИЕ БИЗНЕСА (Q2 2025):
🟢 Сильные стороны: высокая выручка 1.08B IDR, отличный ROAS 30.05x, качество 4.79/5.0
🔴 Критические риски: 5 критических дней с потерями 25.4M IDR, праздничная уязвимость
🎯 Ключевой инсайт: успешный ресторан с локальными провалами в праздники

💰 ФИНАНСОВЫЙ ПОТЕНЦИАЛ:
├─ Текущая выручка: 1 080.9M IDR (Q2 2025)
├─ Потенциал: 1 210.6M IDR (+12% рост)
├─ Потери: 25.4M → 8.1M IDR (-68% снижение)
└─ Чистый эффект: +147.3M IDR дополнительной прибыли

🚀 ПЛАН ДЕЙСТВИЙ:
🔴 КРИТИЧНО (48 часов):
  1. Праздничная стратегия (Eid al-Fitr, Galungan, Kartini Day) → +18.2M IDR/квартал
  2. Увеличение рекламы в 10 праздничных дней Q2 на 50-100% → +12.8M IDR

🟡 ВАЖНО (2 недели):  
  3. Таргетинг немусульман/туристов в религиозные праздники → +8.4M IDR
  4. Балийские праздники (Galungan, Odalan) — локальные акции → +6.7M IDR

📈 ROADMAP (3 квартала):
  • Q3 2025: стратегия для 44 праздников в году → 1 150M IDR (+6.4%)
  • Q4 2025: сезонные стратегии + новогодние → 1 280M IDR (+18.4%)  
  • Q1 2026: полная автоматизация всех праздников → 1 420M IDR (+31.4%)

🎯 ГЛАВНАЯ РЕКОМЕНДАЦИЯ:
Разработать комплексную стратегию для всех 44 праздников (мусульманские, 
балийские, индонезийские, международные). В Q2 было 10 праздничных дней.
Результат: +147M IDR дополнительной прибыли за квартал.

---

## Пример анализа базы (Live API, июнь-июль 2025)

Вкладка "Анализ базы" после развертывания с live API:

```
📊 KPI ПАНЕЛЬ — ОБЩИЙ АНАЛИЗ БАЗЫ
════════════════════════════════════════════════════════════════════════════════
Период: июнь-июль 2025 (Live API Data)
Обновлено: 2025-08-15 14:30 UTC

1. 💰 ОБЩАЯ ВЫРУЧКА
────────────────────────────────────────
├─ Июнь 2025: 2 847 392 100 IDR
├─ Июль 2025: 3 156 847 200 IDR
├─ Рост MoM: +10.9% (+309.5M IDR)
└─ Средняя дневная выручка: 96.9M IDR

2. 📦 ОБЩИЕ ЗАКАЗЫ
────────────────────────────────────────
├─ Июнь 2025: 12 847 заказов
├─ Июль 2025: 14 293 заказов  
├─ Рост MoM: +11.3% (+1 446 заказов)
└─ Средние заказы в день: 438 шт

3. 💵 СРЕДНИЙ ЧЕК (AOV)
────────────────────────────────────────
├─ Июнь 2025: 221 542 IDR
├─ Июль 2025: 220 891 IDR
├─ Изменение MoM: -0.3% (-651 IDR)
└─ Стабильность чека: хорошая

4. 🎯 ROAS (Return on Ad Spend)
────────────────────────────────────────
├─ Июнь 2025: 18.7x
├─ Июль 2025: 19.4x
├─ Улучшение: +0.7x (+3.7%)
└─ Эффективность рекламы: отличная

5. 📈 MER (Marketing Efficiency Ratio)
────────────────────────────────────────
├─ Июнь 2025: 16.2%
├─ Июль 2025: 17.1%
├─ Улучшение: +0.9% пункта
└─ Доля рекламных продаж: растет

6. ❌ ОТМЕНЫ И ПОТЕРИ
────────────────────────────────────────
├─ Июнь 2025: 847 отмен (6.6% от заказов)
├─ Июль 2025: 923 отмен (6.5% от заказов)  
├─ Изменение: -0.1% пункта (улучшение)
└─ Потери: 28.4M IDR за 2 месяца

7. 📊 ТОПОВЫЕ РЕСТОРАНЫ (по выручке за июль)
────────────────────────────────────────
1. 🥇 Ika Canggu: 387.2M IDR (12.3% от общей)
2. 🥈 Only Eggs: 230.6M IDR (7.3% от общей)  
3. 🥉 Warung Sunset: 198.4M IDR (6.3% от общей)
4. 4️⃣ Bali Bowls: 156.8M IDR (5.0% от общей)
5. 5️⃣ Nasi Goreng King: 142.3M IDR (4.5% от общей)

8. 📱 АНАЛИЗ ПО ПЛАТФОРМАМ
────────────────────────────────────────
┌─ 📊 GRAB (июль 2025)
│  ├─ Выручка: 1 892.1M IDR (59.9% от общей)
│  ├─ Заказы: 8 234 (57.6% от общих)
│  ├─ Средний чек: 229 847 IDR
│  └─ ROAS: 16.8x
│
└─ 🛵 GOJEK (июль 2025)
   ├─ Выручка: 1 264.7M IDR (40.1% от общей)  
   ├─ Заказы: 6 059 (42.4% от общих)
   ├─ Средний чек: 208 721 IDR
   └─ ROAS: 23.2x (лучше GRAB!)

9. 🌍 РЕГИОНАЛЬНЫЙ АНАЛИЗ
────────────────────────────────────────
├─ Canggu: 1 247.3M IDR (39.5%) — туристический центр
├─ Ubud: 894.6M IDR (28.4%) — культурный центр  
├─ Seminyak: 672.1M IDR (21.3%) — премиум сегмент
├─ Kuta: 234.8M IDR (7.4%) — бюджетный сегмент
└─ Другие: 107.4M IDR (3.4%)

10. 🎊 ВЛИЯНИЕ ПРАЗДНИКОВ (июнь-июль 2025)
────────────────────────────────────────
📅 Праздничных дней: 11 из 61 (18.0%)
├─ 🕌 Мусульманские: 3 дня (Eid al-Adha, Islamic New Year)
├─ 🏛️ Балийские: 4 дня (Galungan, Kuningan, Purnama)  
├─ 🇮🇩 Индонезийские: 2 дня (Pancasila Day, Constitution Day)
└─ 🌍 Международные: 2 дня (Father's Day, Independence Day USA)

💸 Потери от праздников: 127.3M IDR (4.0% от выручки)
🎯 Потенциал оптимизации: 89.1M IDR (праздничные стратегии)

11. 🌦️ ВЛИЯНИЕ ПОГОДЫ
────────────────────────────────────────
├─ Дождливых дней: 18 из 61 (29.5%)
├─ Средний дождь: 3.2 мм/день
├─ Сильные дожди (>10мм): 6 дней
└─ Потери от дождя: 45.7M IDR

12. 🔥 КРИТИЧЕСКИЕ ДНИ БАЗЫ
────────────────────────────────────────
📊 Найдено: 8 критических дней (падение >25% от медианы)
├─ 2025-06-07: Eid al-Adha (-31.2%) — 67.4M IDR потери
├─ 2025-07-04: Independence Day USA (-28.7%) — 52.1M IDR потери  
├─ 2025-06-27: Islamic New Year (-26.8%) — 48.9M IDR потери
└─ Остальные 5 дней: 89.3M IDR потери

13. 🎯 КЛЮЧЕВЫЕ ИНСАЙТЫ
────────────────────────────────────────
✅ Сильные стороны:
  • GOJEK показывает лучший ROAS (23.2x vs 16.8x у GRAB)
  • Стабильный рост заказов (+11.3% MoM)
  • Низкий процент отмен (6.5%)

⚠️ Области для улучшения:
  • Средний чек снижается (-0.3% MoM)
  • Праздничные дни дают большие потери (127M IDR)
  • Дисбаланс платформ (GRAB 60% vs GOJEK 40%)

14. 📈 СТРАТЕГИЧЕСКИЕ РЕКОМЕНДАЦИИ
────────────────────────────────────────
1. 🔴 Перераспределить бюджет в пользу GOJEK (+30% эффективность)
2. 🟡 Разработать праздничные стратегии (потенциал 89M IDR)
3. 🟡 Погодные промо в дождливые дни (потенциал 32M IDR)
4. 🟢 Upsell стратегии для поддержания среднего чека

💎 ОБЩИЙ ПОТЕНЦИАЛ РОСТА: +187.4M IDR в месяц (+5.9%)
```

---